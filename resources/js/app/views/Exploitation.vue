<template>
    <v-container fluid>
        <v-row no-gutters style="max-height: 100vh;" class="justify-center align-center my-15">
            <v-col cols="12" lg="6" xl="6" md="6" sm="6">
                    <v-card
                        class="ml-lg-15 mr-sm-3"
                        max-width="600"
                        min-height="450"
                    >
                        <v-card-text>
                            <v-row no-gutters class="align-center">
                                <v-col cols="8">
                                    <h3 class="text-right font-weight-bold text-uppercase mt-5"> Votre exploitation </h3>
                                </v-col>
                                <v-col class="d-flex justify-end">
                                    <v-btn icon small class="transparent green--text" v-if="!isEdited" @click="activeEdit">
                                        <v-icon>
                                            mdi-square-edit-outline
                                        </v-icon>
                                    </v-btn>

                                    <v-btn icon small class="transparent red--text" v-else @click="disabledEdit">
                                        <v-icon>
                                            mdi-close-octagon
                                        </v-icon>
                                    </v-btn>
                                </v-col>
                            </v-row>
                            
                            <div style="min-height: 300px !important;">
                                <v-form ref="form" v-model="valid" lazy-validation>
                                    <v-row no-gutters>
                                        <v-autocomplete
                                        v-model="select"
                                        :items="items"
                                        :search-input.sync="searchAutocomplete"
                                        class="w-100 px-3 py-2 mt-8 mx-auto"
                                        flat
                                        hide-no-data
                                        hide-selected
                                        solo-inverted
                                        return-object
                                        item-text="properties.label"
                                        item-value="properties.label"
                                        clearable
                                        prepend-icon="mdi-map-marker"
                                        :disabled="!isEdited"
                                        no-filter
                                        >
                                        </v-autocomplete>
                                    </v-row>
                                    
                                    <v-row no-gutters class="mt-0">
                                        <v-textarea
                                        class="w-100 px-3 mx-auto"
                                        counter
                                        label="Description rapide de vos produits"
                                        :rules="rules"
                                        :value="description"
                                        v-model="description"
                                        clearable
                                        outlined
                                        :disabled="!isEdited"
                                        ></v-textarea>
                                    </v-row>
                                </v-form>
                            </div>
                           
                        </v-card-text>

                         <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn small class="teal darken-1 white--text"  @click="saveData" :disabled="!isEdited">Sauvegarder</v-btn>
                            <v-spacer></v-spacer>
                        </v-card-actions>
                    </v-card>
            </v-col>

            <v-col cols="12" lg="6" xl="6" md="6" sm="6" class="pr-lg-15">
                <v-card>
                    <l-map
                        :center="center"
                        :zoom="zoom"
                        class="map2"
                        ref="map"
                        @update:zoom="zoomUpdated"
                        @update:center="centerUpdated"
                    >
                        <l-tile-layer :url="url"></l-tile-layer>
                        <l-control class="resetControl">
                            <button @click="resetZoom">
                                Reset
                            </button>
                        </l-control>
                        
                        <l-marker v-for="marker in exploitation" :key="marker.id" :lat-lng="marker.coordinates">
                            <l-popup>
                                <div>
                                    <p> 
                                        Adresse : <br>
                                        {{ marker.address }}
                                    </p>
                                </div>
                            </l-popup>
                        </l-marker>
                    </l-map>
                </v-card>
               
            </v-col>
        </v-row>
    </v-container>
</template>

<script src="./js/exploitation.js"></script>